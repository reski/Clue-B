[gd_scene load_steps=11 format=3 uid="uid://byeghi44g35wp"]

[ext_resource type="Script" uid="uid://c67p08x1gmnl7" path="res://scripts/player.gd" id="1"]
[ext_resource type="Script" uid="uid://b6kcfywt0h6o6" path="res://scripts/npc.gd" id="2"]
[ext_resource type="Script" uid="uid://dm8oxwqk6kvyb" path="res://scripts/dialogue_system.gd" id="3"]
[ext_resource type="Script" uid="uid://bmmrtn1rvesa7" path="res://scripts/dialogue_ui.gd" id="4"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_2"]
size = Vector2(320, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_3"]
size = Vector2(16, 196)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_4"]
size = Vector2(48, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_1"]
size = Vector2(16, 20)

[sub_resource type="CircleShape2D" id="CircleShape2D_1"]
radius = 28.0

[sub_resource type="CircleShape2D" id="CircleShape2D_2"]
radius = 28.0

[node name="World" type="Node2D"]

[node name="Environment" type="Node2D" parent="."]

[node name="Ground" type="Polygon2D" parent="Environment"]
z_index = -10
color = Color(0.2, 0.6, 0.2, 1)
polygon = PackedVector2Array(-160, -90, 160, -90, 160, 90, -160, 90)

[node name="Walls" type="Node2D" parent="Environment"]

[node name="TopWall" type="StaticBody2D" parent="Environment/Walls"]
position = Vector2(0, -98)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/Walls/TopWall"]
shape = SubResource("RectangleShape2D_2")

[node name="Visual" type="Polygon2D" parent="Environment/Walls/TopWall"]
color = Color(0.2, 0.2, 0.2, 1)
polygon = PackedVector2Array(-160, -8, 160, -8, 160, 8, -160, 8)

[node name="BottomWall" type="StaticBody2D" parent="Environment/Walls"]
position = Vector2(0, 98)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/Walls/BottomWall"]
shape = SubResource("RectangleShape2D_2")

[node name="Visual" type="Polygon2D" parent="Environment/Walls/BottomWall"]
color = Color(0.2, 0.2, 0.2, 1)
polygon = PackedVector2Array(-160, -8, 160, -8, 160, 8, -160, 8)

[node name="LeftWall" type="StaticBody2D" parent="Environment/Walls"]
position = Vector2(-168, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/Walls/LeftWall"]
shape = SubResource("RectangleShape2D_3")

[node name="Visual" type="Polygon2D" parent="Environment/Walls/LeftWall"]
color = Color(0.2, 0.2, 0.2, 1)
polygon = PackedVector2Array(-8, -98, 8, -98, 8, 98, -8, 98)

[node name="RightWall" type="StaticBody2D" parent="Environment/Walls"]
position = Vector2(168, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/Walls/RightWall"]
shape = SubResource("RectangleShape2D_3")

[node name="Visual" type="Polygon2D" parent="Environment/Walls/RightWall"]
color = Color(0.2, 0.2, 0.2, 1)
polygon = PackedVector2Array(-8, -98, 8, -98, 8, 98, -8, 98)

[node name="Crate" type="StaticBody2D" parent="Environment/Walls"]
position = Vector2(40, 20)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/Walls/Crate"]
shape = SubResource("RectangleShape2D_4")

[node name="Visual" type="Polygon2D" parent="Environment/Walls/Crate"]
color = Color(0.35, 0.25, 0.15, 1)
polygon = PackedVector2Array(-24, -8, 24, -8, 24, 8, -24, 8)

[node name="Actors" type="Node2D" parent="."]
y_sort_enabled = true

[node name="Player" type="CharacterBody2D" parent="Actors"]
position = Vector2(-68.025, 10)
script = ExtResource("1")
dialogue_system_path = NodePath("../../DialogueSystem")

[node name="Visual" type="Polygon2D" parent="Actors/Player"]
color = Color(0.2, 0.4, 1, 1)
polygon = PackedVector2Array(-8, -12, 8, -12, 8, 12, -8, 12)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Actors/Player"]
shape = SubResource("RectangleShape2D_1")

[node name="InteractDetector" type="Area2D" parent="Actors/Player"]
collision_layer = 2
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Actors/Player/InteractDetector"]
shape = SubResource("CircleShape2D_1")

[node name="NPCs" type="Node2D" parent="Actors"]

[node name="NPC_01" type="Node2D" parent="Actors/NPCs"]
position = Vector2(40, -10)
script = ExtResource("2")
npc_name = "Rojo"
dialogue_lines = Array[String](["Hola! Soy el NPC rojo.", "Prob√° moverte con WASD o flechas.", "Y hablame con Enter o E."])

[node name="Visual" type="Polygon2D" parent="Actors/NPCs/NPC_01"]
color = Color(1, 0.25, 0.25, 1)
polygon = PackedVector2Array(-8, -12, 8, -12, 8, 12, -8, 12)

[node name="Body" type="StaticBody2D" parent="Actors/NPCs/NPC_01"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Actors/NPCs/NPC_01/Body"]
shape = SubResource("RectangleShape2D_1")

[node name="TalkArea" type="Area2D" parent="Actors/NPCs/NPC_01"]
collision_layer = 2
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Actors/NPCs/NPC_01/TalkArea"]
shape = SubResource("CircleShape2D_2")

[node name="NPC_02" type="Node2D" parent="Actors/NPCs"]
position = Vector2(90, 35)
script = ExtResource("2")
npc_name = "Amarillo"
dialogue_lines = Array[String](["Ey!", "Yo soy el NPC amarillo.", "Despues le metemos sistema de dialogos con JSON"])

[node name="Visual" type="Polygon2D" parent="Actors/NPCs/NPC_02"]
color = Color(1, 0.9, 0.2, 1)
polygon = PackedVector2Array(-8, -12, 8, -12, 8, 12, -8, 12)

[node name="Body" type="StaticBody2D" parent="Actors/NPCs/NPC_02"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Actors/NPCs/NPC_02/Body"]
shape = SubResource("RectangleShape2D_1")

[node name="TalkArea" type="Area2D" parent="Actors/NPCs/NPC_02"]
collision_layer = 2
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Actors/NPCs/NPC_02/TalkArea"]
shape = SubResource("CircleShape2D_2")

[node name="Camera2D" type="Camera2D" parent="."]

[node name="DialogueSystem" type="Node" parent="."]
script = ExtResource("3")
dialogue_ui_path = NodePath("../UI/DialogueUI")

[node name="Audio" type="Node" parent="."]

[node name="BGM" type="AudioStreamPlayer" parent="Audio"]

[node name="SFX" type="AudioStreamPlayer" parent="Audio"]

[node name="UI" type="CanvasLayer" parent="."]

[node name="DialogueUI" type="Control" parent="UI"]
visible = false
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
script = ExtResource("4")

[node name="Panel" type="PanelContainer" parent="UI/DialogueUI"]
layout_mode = 0
anchor_left = 0.05
anchor_top = 0.68
anchor_right = 0.95
anchor_bottom = 0.95

[node name="Margin" type="MarginContainer" parent="UI/DialogueUI/Panel"]
layout_mode = 2
theme_override_constants/margin_left = 12
theme_override_constants/margin_top = 10
theme_override_constants/margin_right = 12
theme_override_constants/margin_bottom = 10

[node name="Layout" type="VBoxContainer" parent="UI/DialogueUI/Panel/Margin"]
layout_mode = 2

[node name="NameLabel" type="Label" parent="UI/DialogueUI/Panel/Margin/Layout"]
layout_mode = 2
text = "NPC"

[node name="Text" type="RichTextLabel" parent="UI/DialogueUI/Panel/Margin/Layout"]
layout_mode = 2
bbcode_enabled = true
text = "..."
fit_content = true

[node name="NextHint" type="Label" parent="UI/DialogueUI/Panel/Margin/Layout"]
layout_mode = 2
text = "Enter / E para continuar"
